@model IEnumerable<novelaweb2.Models.Novela>
@{
    ViewData["Title"] = "Administrar novelas";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <h2 class="mb-3 text-light">Administrar novelas</h2>

    <table class="table table-dark table-striped align-middle">
        <thead>
            <tr>
                <th>Título</th>
                <th>Autor</th>
                <th>Capítulos</th>
                <th>Estado</th>
                <th class="text-end">Acciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var n in Model)
            {
                <tr>
                    <td>@n.Titulo</td>
                    <td>@n.Autor?.NombreUsuario</td>
                    <td>@(n.Capitulos?.Count ?? 0)</td>
                    <td>@n.Estado</td>
                    <td class="text-end">
                        <a asp-action="DetalleNovela" asp-route-id="@n.Id"
                           class="btn btn-sm btn-primary me-1">
                            <i class="fa fa-eye"></i>
                        </a>

                        <a asp-action="EditarNovela" asp-route-id="@n.Id"
                           class="btn btn-sm btn-warning me-1">
                            <i class="fa fa-edit"></i>
                        </a>

                        <form asp-action="EliminarNovela" asp-route-id="@n.Id"
                              method="post" class="d-inline frm-delete-novela">
                            <button type="submit" class="btn btn-sm btn-danger">
                                <i class="fa fa-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.querySelectorAll(".frm-delete-novela").forEach(f => {
            f.addEventListener("submit", function (e) {
                e.preventDefault();
                const form = this;
                Swal.fire({
                    title: "¿Eliminar novela?",
                    text: "Esta acción no se puede deshacer.",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Sí, eliminar",
                    cancelButtonText: "Cancelar"
                }).then(r => {
                    if (r.isConfirmed) form.submit();
                });
            });
        });
    </script>
}
